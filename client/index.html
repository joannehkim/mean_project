<!DOCTYPE html>
<html ng-app='myApp'>

<head>
	<title>MEAN PROJECT</title>
	<script type="text/javascript" script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
	<script type="text/javascript" script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <link rel='stylesheet' href='./static/style.css'>

<script>
    var myApp = angular.module('myApp', ['ngRoute'])
      .config(function($routeProvider){
        $routeProvider
          .when('/', {
            templateUrl: "/partials/index.html",
            // controller: "loginController"
          })
          .when('/login', {
            templateUrl: "/partials/login.html"
            // controller: "successController"
          })
          .when('/register', {
            templateUrl: "/partials/register.html"
            // controller: "successController"
          })
          .when('/success', {
          	templateUrl: "/partials/main.html",
            controller: "MainController"
          })
          .when('/new_event', {
            templateUrl: "/partials/new_event.html",
            controller:"MainController"
          })
          .when('/event_details', {
            templateUrl: "/partials/event_details.html"
          })
          .when('/edit_event/:id',{
            templateUrl: "/partials/edit_event.html",
            controller:"EditController"
          })
      })
      // .controller('loginController', loginController)
      // .controller('MainController', MainController)
      // .factory('loginFactory', loginFactory)
      // .factory('topicFactory', topicFactory)
      myApp.factory('TaskFactory', function($http, $location){
        var factory = {};
        var tasks = [];
        var currentTask = {};
        factory.index = function(callback){
          $http.get('/tasks').success(function(output){
            tasks = output;
            callback(tasks);
          })
        }
        factory.create = function(info, callback){
          $http.post('/addTask', info).success(function(output){
            tasks.push({name:info.name, desc: info.desc, date: info.date, category: info.category, completed: 0});
            callback();

          })
        }
        factory.delete = function(info, callback){
          $http.post('/deleteTask', info).success(function(output){
            tasks.splice(tasks.indexOf(info), 1);
          })
        }
        factory.toggle = function(info, callback){
          $http.post('/toggleTask', info).success(function(output){
            callback();
          })
        }
        factory.findOne = function(info, callback){
          $http.post('/findTask', info).success(function(output){
            currentTask= output;
            callback(currentTask);
          })
        }
        factory.update = function(info, callback){
          $http.post('/editTask', info).success(function(output){
            callback();
          })
        }
        return factory;
      });

      //REGISTRATION FACTORY
      myApp.factory('RegisterFactory', function($http) {

         var factory = {};

         factory.create = function(newUser, callback){
           $http.post('/register', newUser).success(function(getUsers) {
             callback(users);
           })
         }

         return factory;

       });

      //LOGIN FACTORY
      myApp.factory('LoginFactory', function($http) {
         var factory ={};

         factory.index = function(user, callback) {
           $http.post('/login', user).success(function(getUser){
             req.session.mainUser = getUser;
             mainPerson = req.session.mainUser;

             user = getUser
             callback(user);
           })
         }
         return factory;
      });
      myApp.controller('MainController', function(TaskFactory, $scope, $location){
        $scope.new_task = {};
        $scope.tasks = [];
        TaskFactory.index(function(data){
          $scope.tasks = data;
        });
        $scope.addTask = function(){
          console.log('clicked add task');
          $scope.new_task.completed = "Incomplete";
          console.log($scope.new_task);
          TaskFactory.create($scope.new_task, function(data){
            $scope.new_task = {};
            console.log("HERE");
            $location.path('/success');
          })
        }
        $scope.toggleStatus = function(task){
          console.log('clicked on change status');
          TaskFactory.toggle(task, function(data){
            TaskFactory.index(function(data){
              $scope.tasks = data;
            })
          })
        }
        $scope.removeTask = function(task){
          console.log('clicked on delete task');
          TaskFactory.delete(task, function(data){
            console.log('successfully deleted task');
          })
        }

          $(document).ready(function() {
            $(document).on("click", "#special", function() {
              $('#category').val("Special");
              $scope.new_task.category = "Special";
            })
            $(document).on("click", "#shopping", function() {
              $('#category').val("Shopping");
              $scope.new_task.category = "Shopping";
            })
            $(document).on("click", "#work", function() {
              $('#category').val("Work");
              $scope.new_task.category = "Work";
            })
            $(document).on("click", "#travel", function() {
              $('#category').val("Travel");
              $scope.new_task.category = "Travel";
            })
            $(document).on("click", "#study", function() {
              $('#category').val("Study");
              $scope.new_task.category = "Study";
            })
            $(document).on("click", "#errands", function() {
              $('#category').val("Errands");
              $scope.new_task.category = "Errands";
            })
          })  
      });
      myApp.controller('EditController', function(TaskFactory, $scope, $location, $routeParams){
        $scope.task = {};
        $scope.currentTask = {};
        TaskFactory.findOne({id:$routeParams.id}, function(data){
          $scope.currentTask = data;
          console.log($scope.currentTask);
          $scope.task = $scope.currentTask;
        });
        
        $scope.editTask = function(task){
          console.log('clicked on edit task');
          TaskFactory.update(task, function(data){
            console.log('successfully edited task');
            $scope.currentTask= data;
            $location.path('/success');
          })
        }

          $(document).ready(function() {
            $(document).on("click", "#special", function() {
              $('#category').val("Special");
              $scope.task.category = "Special";
            })
            $(document).on("click", "#shopping", function() {
              $('#category').val("Shopping");
              $scope.task.category = "Shopping";
            })
            $(document).on("click", "#work", function() {
              $('#category').val("Work");
              $scope.task.category = "Work";
            })
            $(document).on("click", "#travel", function() {
              $('#category').val("Travel");
              $scope.task.category = "Travel";
            })
            $(document).on("click", "#study", function() {
              $('#category').val("Study");
              $scope.task.category = "Study";
            })
            $(document).on("click", "#errands", function() {
              $('#category').val("Errands");
              $scope.task.category = "Errands";
            })
          })  
      });

      //LOGIN CONTROLLER
      myApp.controller('LoginController', function($scope, LoginFactory) {

         $scope.login= function(user) {
           LoginFactory.index(user, function(user) {
             $scope.currentUser = user;
             $scope.user={};
           })
         }
       });


      //REGISTRATION CONTROLLER
      myApp.controller('RegisterController', function($scope, RegisterFactory) {
         $scope.newUser = {};

         $scope.addNewUser = function(newUser) {
           RegisterFactory.create(newUser, function (newUser){
             console.log(newUser);
             $scope.newUser = {};
           })
         }
       });
</script>

</head>

<body ng-app='myApp'>

	<a class = 'links' href='#/'>Dashboard</a> | <a class= 'links' href='#/new_event'>Add a new Event</a> 
  <div id="banner">
    <img src="/static/banner.jpg">
      <div id = 'partial' ng-view="">
      </div>
  </div>
</body>
</html>

